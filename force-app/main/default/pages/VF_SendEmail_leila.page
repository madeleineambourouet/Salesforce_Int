<apex:page id="SendEmail" standardController="Projet__c" extensions="VFC_SendEmail_leila" showHeader="false" cache="true" doctype="html-5.0">
    <apex:includescript value="{!URLFOR($Resource.CkEditor,'ckeditor/ckeditor.js')}" /> 
    <script type="text/javascript">
    function ReloadCKEditor() {
        for(name in CKEDITOR.instances)
                      
        {
            delete CKEDITOR.instances[name];                    
        }
        CKEDITOR.replaceAll();                      
    }
    </script> 
   
    <style>
  
.sf1form {
    background-color: #ffffff;
    padding: 10px 10px 10px 10px;
}
 
.sf1label {
    font-family: 'Salesforce Sans','Arial','Helvetica','sans-serif';
    font-size: 11px;
    font-weight: bold;
    color: #54698D;
    margin: 0;
    padding-bottom: 5px;
    display: block;
    /*
    min-width: 80px;
    */
}
 
.sf1input, .sf1textarea{
    width:80%;
    font-size: 12px;
    font-family: 'Salesforce Sans','Arial','Helvetica','sans-serif';
    color: #3c3d3e;
        padding: 7px 14px;
 
    line-height: 25px;
    border: 1px solid #cfd0d2;
    border-radius: 5px;
    background-color: #fff; //#e8eaeb;
    box-shadow: inset 0 2px 2px rgba(0,0,0,.07);
    margin:2px 20px 2px 2px;
    padding-bottom: 5px;
}
 
.sf1input:focus, .sf1textarea:focus {
    border: 1px solid #bbc0c4;
    background-color: #fff;
    outline-style: none;
}
 
.sf1select {
    -moz-appearance: none;
    -webkit-appearance: none;
    border: 1px solid #bbc0c4;
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImRvd25fMV8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNjRweCIgaGVpZ2h0PSI2NHB4IiB2aWV3Qm94PSIwIDAgNjQgNjQiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDY0IDY0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJEb3duX3g0MF8yeC5wbmdfMV8iPg0KCTxnIGlkPSJkaXJlY3Rkb3duX2NvcHkiPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiM5Njk4OTkiIGQ9Ik01NS4wNjYsMTcuODY2Yy0wLjUzMy0wLjkzNC0xLjQ2Ny0xLjUzMy0yLjUzMy0xLjZDNTIuMzk4LDE2LjE5OSw0Mi4zOTgsMTUuNiwzMiwxNS42DQoJCQkJYy0xMC4zOTksMC0yMC40LDAuNi0yMC41MzMsMC42NjdjLTEuMDY2LDAuMDY2LTIuMDY2LDAuNjY2LTIuNTMzLDEuNmMtMC41MzMsMC45MzQtMC41MzMsMi4wNjYsMCwzDQoJCQkJYzcuOTMzLDE0LjA2NiwyMC40LDI2LjI2NywyMC45MzMsMjYuNzMyYzEuMiwxLjA2NiwzLjA2NiwxLjA2Niw0LjI2NywwYzAuNTMzLTAuNDY3LDEzLTEyLjY2NiwyMC45MzMtMjYuNzMyDQoJCQkJQzU1LjYsMTkuOTMzLDU1LjYsMTguOCw1NS4wNjYsMTcuODY2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=);
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImRvd25fMV8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNjRweCIgaGVpZ2h0PSI2NHB4IiB2aWV3Qm94PSIwIDAgNjQgNjQiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDY0IDY0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJEb3duX3g0MF8yeC5wbmdfMV8iPg0KCTxnIGlkPSJkaXJlY3Rkb3duX2NvcHkiPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiM5Njk4OTkiIGQ9Ik01NS4wNjYsMTcuODY2Yy0wLjUzMy0wLjkzNC0xLjQ2Ny0xLjUzMy0yLjUzMy0xLjZDNTIuMzk4LDE2LjE5OSw0Mi4zOTgsMTUuNiwzMiwxNS42DQoJCQkJYy0xMC4zOTksMC0yMC40LDAuNi0yMC41MzMsMC42NjdjLTEuMDY2LDAuMDY2LTIuMDY2LDAuNjY2LTIuNTMzLDEuNmMtMC41MzMsMC45MzQtMC41MzMsMi4wNjYsMCwzDQoJCQkJYzcuOTMzLDE0LjA2NiwyMC40LDI2LjI2NywyMC45MzMsMjYuNzMyYzEuMiwxLjA2NiwzLjA2NiwxLjA2Niw0LjI2NywwYzAuNTMzLTAuNDY3LDEzLTEyLjY2NiwyMC45MzMtMjYuNzMyDQoJCQkJQzU1LjYsMTkuOTMzLDU1LjYsMTguOCw1NS4wNjYsMTcuODY2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=),-moz-linear-gradient(#ffffff,#f1f1f1);
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImRvd25fMV8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNjRweCIgaGVpZ2h0PSI2NHB4IiB2aWV3Qm94PSIwIDAgNjQgNjQiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDY0IDY0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJEb3duX3g0MF8yeC5wbmdfMV8iPg0KCTxnIGlkPSJkaXJlY3Rkb3duX2NvcHkiPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiM5Njk4OTkiIGQ9Ik01NS4wNjYsMTcuODY2Yy0wLjUzMy0wLjkzNC0xLjQ2Ny0xLjUzMy0yLjUzMy0xLjZDNTIuMzk4LDE2LjE5OSw0Mi4zOTgsMTUuNiwzMiwxNS42DQoJCQkJYy0xMC4zOTksMC0yMC40LDAuNi0yMC41MzMsMC42NjdjLTEuMDY2LDAuMDY2LTIuMDY2LDAuNjY2LTIuNTMzLDEuNmMtMC41MzMsMC45MzQtMC41MzMsMi4wNjYsMCwzDQoJCQkJYzcuOTMzLDE0LjA2NiwyMC40LDI2LjI2NywyMC45MzMsMjYuNzMyYzEuMiwxLjA2NiwzLjA2NiwxLjA2Niw0LjI2NywwYzAuNTMzLTAuNDY3LDEzLTEyLjY2NiwyMC45MzMtMjYuNzMyDQoJCQkJQzU1LjYsMTkuOTMzLDU1LjYsMTguOCw1NS4wNjYsMTcuODY2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=),-webkit-linear-gradient(#ffffff,#f1f1f1);
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImRvd25fMV8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNjRweCIgaGVpZ2h0PSI2NHB4IiB2aWV3Qm94PSIwIDAgNjQgNjQiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDY0IDY0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJEb3duX3g0MF8yeC5wbmdfMV8iPg0KCTxnIGlkPSJkaXJlY3Rkb3duX2NvcHkiPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiM5Njk4OTkiIGQ9Ik01NS4wNjYsMTcuODY2Yy0wLjUzMy0wLjkzNC0xLjQ2Ny0xLjUzMy0yLjUzMy0xLjZDNTIuMzk4LDE2LjE5OSw0Mi4zOTgsMTUuNiwzMiwxNS42DQoJCQkJYy0xMC4zOTksMC0yMC40LDAuNi0yMC41MzMsMC42NjdjLTEuMDY2LDAuMDY2LTIuMDY2LDAuNjY2LTIuNTMzLDEuNmMtMC41MzMsMC45MzQtMC41MzMsMi4wNjYsMCwzDQoJCQkJYzcuOTMzLDE0LjA2NiwyMC40LDI2LjI2NywyMC45MzMsMjYuNzMyYzEuMiwxLjA2NiwzLjA2NiwxLjA2Niw0LjI2NywwYzAuNTMzLTAuNDY3LDEzLTEyLjY2NiwyMC45MzMtMjYuNzMyDQoJCQkJQzU1LjYsMTkuOTMzLDU1LjYsMTguOCw1NS4wNjYsMTcuODY2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=),-ms-linear-gradient(#ffffff,#f1f1f1);
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImRvd25fMV8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNjRweCIgaGVpZ2h0PSI2NHB4IiB2aWV3Qm94PSIwIDAgNjQgNjQiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDY0IDY0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJEb3duX3g0MF8yeC5wbmdfMV8iPg0KCTxnIGlkPSJkaXJlY3Rkb3duX2NvcHkiPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiM5Njk4OTkiIGQ9Ik01NS4wNjYsMTcuODY2Yy0wLjUzMy0wLjkzNC0xLjQ2Ny0xLjUzMy0yLjUzMy0xLjZDNTIuMzk4LDE2LjE5OSw0Mi4zOTgsMTUuNiwzMiwxNS42DQoJCQkJYy0xMC4zOTksMC0yMC40LDAuNi0yMC41MzMsMC42NjdjLTEuMDY2LDAuMDY2LTIuMDY2LDAuNjY2LTIuNTMzLDEuNmMtMC41MzMsMC45MzQtMC41MzMsMi4wNjYsMCwzDQoJCQkJYzcuOTMzLDE0LjA2NiwyMC40LDI2LjI2NywyMC45MzMsMjYuNzMyYzEuMiwxLjA2NiwzLjA2NiwxLjA2Niw0LjI2NywwYzAuNTMzLTAuNDY3LDEzLTEyLjY2NiwyMC45MzMtMjYuNzMyDQoJCQkJQzU1LjYsMTkuOTMzLDU1LjYsMTguOCw1NS4wNjYsMTcuODY2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=),linear-gradient(#ffffff,#f1f1f1);
    background-repeat: no-repeat;
    background-position: 95% 50%;
    background-size: 16px 16px,100% 100%;
    color: #3c3d3e;
    padding: 7px 14px;
    line-height: 15px;
    font-family: 'Salesforce Sans','Arial','Helvetica','sans-serif';
    font-size: 12px;
    width: 83%;
    margin:0px 20px 2px 2px;
    border: 1px solid #cfd0d2;
    border-radius: 5px;
}
 
.sf1button {
    font-size: 14px;
    font-family: 'Salesforce Sans', 'Arial','Helvetica','sans-serif';
    font-weight: normal;
    color: #44596c;
    text-shadow: none;
    margin: 0;
    padding: 4px 14px;
    height: 35px;
    border: 1px solid #bbc0c4;
    border-radius: 5px;
    background: -moz-linear-gradient(#ffffff,#f1f1f1);
    background: -webkit-linear-gradient(#ffffff,#f1f1f1);
    background: -ms-linear-gradient(#ffffff,#f1f1f1);
    background: linear-gradient(#ffffff,#f1f1f1);
    box-shadow: none;
    text-align: center;
    cursor: pointer;
    box-sizing: border-box;
}
 
.sf1button:active {
    background: #e9e9e9;
}
 
.sf1buttonSFBlue {
    font-size: 14px;
    font-family: 'Salesforce Sans','Arial','Helvetica','sans-serif';
    font-weight: normal;
    color: #44596c;
    text-shadow: none;
    margin: 0;
    padding: 4px 14px;
    height: 35px;
    border: 1px solid #bbc0c4;
    border-radius: 5px;
    background: -moz-linear-gradient(#2a93d5,#107abb);
    background: -webkit-linear-gradient(#2a93d5,#107abb)
    background: -ms-linear-gradient(#2a93d5,#107abb);
    background: linear-gradient(#2a93d5,#107abb);
    box-shadow: none;
    text-align: center;
    cursor: pointer;
    box-sizing: border-box;
    color:white;
}
</style>
 
    <apex:form id="formid">
        <div class="sf1form">
            <input class='sf1input' id='accountId' name='accountId' type='hidden' value='{!AccountX.Id}'/>
            <input class='sf1input' id='projectId' name='projectId' type='hidden' value='{!projetX.Id}'/>
            <input class='sf1input' id='contactId' name='contactId' type='hidden' value='{!ContactX.Id}'/>
        
            <span class='sf1label'>De : Utilisateurs:</span>              
            <!--<select id='User' name='Utilisateur' class="sf1select">
                <option value='{!$User.Id}'>{!$User.FirstName} {!$User.LastName}</option>
            </select>-->
              
    		<apex:SelectList id="SelectUser" value="{!selecteduserId}" size="1"  styleClass="sf1select" multiselect="false" >
      			<apex:selectOptions value="{!ListOfUser}"></apex:selectOptions>
    		</apex:SelectList>
 		   
            <br/>&nbsp;<br/>
            <span class='sf1label'>De : Adresses génériques:</span> 
            
            <apex:SelectList id="SelectOwa" value="{!selectedOwaId}" size="1"  styleClass="sf1select" multiselect="false" >
      			<apex:selectOptions value="{!OrgWideEmailAddress}"></apex:selectOptions>
    		</apex:SelectList>
            
            <br/>&nbsp;<br/>
            <span class='sf1label'>Envoyer votre message à :</span>            
            <select id='email' name='email' class="sf1select">
            <script>
                if ("{!AccountX.PersonEmail}"!="") document.write("<option value='{!AccountX.PersonEmail}'>{!AccountX.PersonEmail}</option>");
                
            </script>   
            </select>
            <br/>&nbsp;<br/>    
            <span class='sf1label'>Sélectionnez un modèle:</span>
            <apex:selectList styleClass="sf1select" id="SelectTemplate"  multiselect="false" size="1" value="{!selectedvalue}" >
                <apex:selectOptions value="{!templates}"/>                           
                <apex:actionSupport event="onchange" 
                                action="{!retreiveTemplate}"                                   
                                rerender="EmailInfoContainer"
                                oncomplete="ReloadCKEditor()"/>
                            
            </apex:selectList>
            <br/>         
			<apex:outputpanel id="EmailInfoContainer" styleClass="sf1form">
        	<span class='sf1label'>Objet de l'email : </span>   
        	<apex:inputText id="subject" value="{!texte}" label="Sujet" styleClass="sf1select" /> 
            
        	<br/>&nbsp;<br/>
                
        	<span class='sf1label'>Message à envoyer :</span>  
			<apex:inputtextarea id="EmailHTMLBody" styleClass="ckeditor" value="{!EmailTemplateValue}" richtext="false" />            
        	</apex:outputpanel>
               
        	<br/>&nbsp;<br/>
            <button type="button" class='sf1buttonSFBlue' onclick="sendFormEmail();">Envoyer l'e-mail</button>
      </div>
    </apex:form>
    
    <script type='text/javascript' src='/canvas/sdk/js/publisher.js'></script>
<script>
        //alert("Def Fct begin");
 
        if (isSalesForce1()) document.getElementById("formid").style.backgroundColor="#f0f1f2";
 
        function isSalesForce1() {
            if( (typeof sforce != 'undefined') && (sforce != null) ) {
                // Salesforce1
                //alert("Salesforce1");
                return true;
            } else {
                //alert("Desktop");
                return false;
            }
        }
 
        function sendFormEmail() {
            //alert("sendFormEmail()");
                var inputData = {"apexType":"VFC_SendEmail_leila.inputData"};
            //alert(document.getElementById("SendEmail:formid:EmailHTMLBody").value);
            console.log(document.getElementById("SendEmail:formid:subject").value);
            //console.log(document.getElementById("SendEmail:formid:textMessage").value);            	
            	console.log(document.getElementById("SendEmail:formid:EmailHTMLBody").value);
            	console.log(document.getElementById("SendEmail:formid:SelectTemplate").value);
            	console.log(document.getElementById("email").value);
            	console.log(document.getElementById("accountId").value);
            	console.log(document.getElementById("contactId").value);
            	console.log(document.getElementById("projectId").value);
            
            inputData.subject = document.getElementById("SendEmail:formid:subject").value; 
            // inputData.body = document.getElementById("textMessage").value;
            	inputData.HtmlValue = document.getElementById("SendEmail:formid:EmailHTMLBody").value;
                inputData.email = document.getElementById("email").value; 
                inputData.templateId= document.getElementById("SendEmail:formid:SelectTemplate").value;  
                inputData.accountId = document.getElementById("accountId").value;  
                inputData.contactId = document.getElementById("contactId").value;  
                inputData.projectId = document.getElementById("projectId").value;  
                VFC_SendEmail_leila.submitData(inputData, function(result, event) {
                    if (result=="OK") {
                        alert("Message envoyé avec succès !");
                        document.getElementById("SendEmail:formid:subject").value="";
                        //document.getElementById("textMessage").value="";
                        document.getElementById("SendEmail:formid:EmailHTMLBody").value="";
                        document.getElementById("SendEmail:formid:SelectTemplate").selectedIndex = "0";
                        Sfdc.canvas.publisher.publish({ name: "publisher.close", payload:{ refresh:"true" }});
                        refreshFeed();
                    } else {
                        alert(result);
                    }
                });
        }
        function refreshFeed() {
            //alert("refreshFeed()");
            Sfdc.canvas.publisher.publish({name : 'publisher.refresh', payload : {feed: true}}); 
        }
        function retreiveTemplate() {
            alert("retreiveTemplate()");
                var inputData = {"apexType":"VFC_SendEmail_leila.inputData"};
                inputData.subject = document.getElementById("subject").value; 
                inputData.body = document.getElementById("textMessage").value; 
                inputData.templateId= document.getElementById("templateId").value;  
                inputData.accountId = document.getElementById("accountId").value;  
                inputData.contactId = document.getElementById("contactId").value;  
                inputData.projectId = document.getElementById("projectId").value;  
            alert(inputData);
                VFC_SendEmail_leila.retreiveTemplate(inputData, function(result, event) {
                    alert(result);
                    document.getElementById("textMessage").value=result;
                });
                VFC_SendEmail_leila.retreiveSubject(inputData, function(result, event) {
                    //alert(result);
                    document.getElementById("sujet").value=result;
                });
        }
 
        // SALESFORCE 1 : Activate Submit button Menu
        Sfdc.canvas.publisher.subscribe({name: "publisher.showPanel",
            onData:function(e) {
                //alert("publisher.showPanel");
                Sfdc.canvas.publisher.publish({name:"publisher.setValidForSubmit", payload:"true"});
        }});
        Sfdc.canvas.publisher.subscribe({ name: "publisher.post",
            onData: function(e) {
                //alert("publisher.post");
                sendFormEmail();
        }});
 
        //alert("Def Fct end");
    </script>
   
</apex:page>